<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>moira.context documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name"></span> <span class="project-version"></span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>moira</span></div></div></li><li class="depth-2 branch"><a href="moira.application.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>application</span></div></a></li><li class="depth-2 branch current"><a href="moira.context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>context</span></div></a></li><li class="depth-2 branch"><a href="moira.event.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>event</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>log</span></div></div></li><li class="depth-3 branch"><a href="moira.log.event-emitter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>event-emitter</span></div></a></li><li class="depth-3 branch"><a href="moira.log.module.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>module</span></div></a></li><li class="depth-3"><a href="moira.log.txs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>txs</span></div></a></li><li class="depth-2 branch"><a href="moira.module.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>module</span></div></a></li><li class="depth-2"><a href="moira.transition.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transition</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="moira.context.html#var--.3Eex"><div class="inner"><span>-&gt;ex</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-done.3F"><div class="inner"><span>done?</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-emit"><div class="inner"><span>emit</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-enqueue"><div class="inner"><span>enqueue</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-enter-1"><div class="inner"><span>enter-1</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-error.3F"><div class="inner"><span>error?</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-execute"><div class="inner"><span>execute</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-execute-1"><div class="inner"><span>execute-1</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-execute-all"><div class="inner"><span>execute-all</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-into-queue"><div class="inner"><span>into-queue</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-into-stack"><div class="inner"><span>into-stack</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-leave-1"><div class="inner"><span>leave-1</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-queue.3F"><div class="inner"><span>queue?</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-stack"><div class="inner"><span>stack</span></div></a></li><li class="depth-1"><a href="moira.context.html#var-terminate"><div class="inner"><span>terminate</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">moira.context</h1><div class="doc"><pre class="plaintext">Implementation of the interceptor pattern based on an asynchronous promise
chain.

Interceptors map hook functions to the three execution stages `:enter`,
`:leave`, and `:error`. All hook functions are optional, will be passed
the current execution context, and need to return an updated context.

When executing a context, first each `:enter` hook is triggered in order.
After that, each intereptor's `:leave` hook will be invoked in reverse order.
At any point, when an error occurs the execution of remaining interceptors is
terminated and the `:error` function of previously processed interceptors is
triggered in reverse order.

The `::queue` of pending interceptors and `::stack` of partially processed
inteceptors are always present on the context. It is perfectly valid for
interceptor hooks to alter those in order to change execution.

The current error is available via `::error`. To catch an error return a
context with the key removed. To signal an error return a context with the
`::error` key present.</pre></div><div class="public anchor" id="var--.3Eex"><h3>-&gt;ex</h3><div class="usage"><code>(-&gt;ex v data)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-done.3F"><h3>done?</h3><div class="usage"><code>(done? ctx n)</code></div><div class="doc"><pre class="plaintext">Returns true, if there are no more pending execution steps.
</pre></div></div><div class="public anchor" id="var-emit"><h3>emit</h3><div class="usage"><code>(emit ctx n)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-enqueue"><h3>enqueue</h3><div class="usage"><code>(enqueue ctx n txs)</code></div><div class="doc"><pre class="plaintext">Add interceptors to the end of the execution queue.
</pre></div></div><div class="public anchor" id="var-enter-1"><h3>enter-1</h3><div class="usage"><code>(enter-1 ctx n)</code></div><div class="doc"><pre class="plaintext">Execute next enter step.

Returns a promise resolving to the updated context. Fails gracefully, if not
applicable.</pre></div></div><div class="public anchor" id="var-error.3F"><h3>error?</h3><div class="usage"><code>(error? ctx n)</code></div><div class="doc"><pre class="plaintext">Returns true, if execution is in error stage.
</pre></div></div><div class="public anchor" id="var-execute"><h3>execute</h3><div class="usage"><code>(execute ctx n txs)</code></div><div class="doc"><pre class="plaintext">Apply a chain of interceptors `txs` to context `ctx`.

`ctx` can be a plain map and will be elevated to be an executable context by
enqueueing `txs`. Returns a promise resolving to the updated context.</pre></div></div><div class="public anchor" id="var-execute-1"><h3>execute-1</h3><div class="usage"><code>(execute-1 ctx n)</code></div><div class="doc"><pre class="plaintext">Execute next enter, leave, or error step.

Returns a promise resolving to the updated context. Fails gracefully, if not
applicable.</pre></div></div><div class="public anchor" id="var-execute-all"><h3>execute-all</h3><div class="usage"><code>(execute-all ctx n)</code></div><div class="doc"><pre class="plaintext">Execute all enter, leave, or error steps.

Returns a promise resolving to the updated context. Fails gracefully, if not
applicable.</pre></div></div><div class="public anchor" id="var-into-queue"><h3>into-queue</h3><div class="usage"><code>(into-queue coll xs)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-into-stack"><h3>into-stack</h3><div class="usage"><code>(into-stack coll xs)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-leave-1"><h3>leave-1</h3><div class="usage"><code>(leave-1 ctx n)</code></div><div class="doc"><pre class="plaintext">Execute next leave or error step.

Returns a promise resolving to the updated context. Fails gracefully, if not
applicable.</pre></div></div><div class="public anchor" id="var-queue.3F"><h3>queue?</h3><div class="usage"><code>(queue? v)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-stack"><h3>stack</h3><div class="usage"><code>(stack ctx n txs)</code></div><div class="doc"><pre class="plaintext">Add inteceptors to the top of the execution stack.
</pre></div></div><div class="public anchor" id="var-terminate"><h3>terminate</h3><div class="usage"><code>(terminate ctx n)</code></div><div class="doc"><pre class="plaintext">Drop execution of any pending interceptors and immediately switch to the
leave stage.</pre></div></div></div></body></html>